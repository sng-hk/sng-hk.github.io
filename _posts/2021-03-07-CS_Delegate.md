---
title: "C# - Delegate 대리자"
layout: single
classes: wide
tags : [C#]
---

지금까지 코드를 작성해올 때는 직관적이고 순차적으로 뭔가를 만들었었다. 그런데 항상 순차적으로 진행되는게 아니라, 상대방에게 무언가를 거꾸로 해달라고 요청하는 상황이 빈번하게 일어난다.
실제 상황과 비유해보면 다음과 같다.
업체 사장님과 통화를 하고싶다고 가정하자. 사장님과 직통으로 연결하면 좋겠지만, 비서를 통해서 연락이 닿는 경우가 있다. 사장님의 비서에게 사장님과 통화 괜찮은지 여쭤본 다음에 지금 바쁘다고 한다면, 우리의 연락처와 용건을 건내준 뒤에 나중에 사장님이 시간이 될 때, 거꾸로 연락을 달라고 요청을 한다. 

가장 대표적인 예로는 UI 작업을 할 때 그렇다.
어떤 버튼을 눌렀을 때, 어떤 행동을 하는 그런 패턴이 자주 등장한다. 예를 들면 편집기의 빌드 버튼을 누르면 여러가지 옵션이 하단으로 나열되어 출력되는 것을 볼 수 있다. 마찬가지로 게임 안에서도 메뉴 버튼을 누르면 메뉴가 출력이 될테고, 공격 버튼을 누르면 플레이어가 공격을 시작할 것이다. 그렇다면 이것을 어떻게 프로그래밍으로 구현을 할까 생각해보면, Button이 눌렸다는 함수가 있을거고 함수 내부에서는 어떤 버튼이 눌렸을지 체크할 것이고 플레이어를 공격 시키거나 하는 행동을 안에 넣으면 된다. 그런데 상황에 따라서 이렇게 구현을 하기 힘든 경우가 많다. 설계적인 측면과 현실적인 측면에서 어렵다. 
설계적인 문제를 먼저 얘기하자면, UI와 관련된 로직과 실제 게임 로직이 얽히는 문제가 있다. 그래서 최대한 UI코드와 게임 로직관련 코드는 분리시켜서 관리하는게 장기적인 차원에서 매우 좋다. 
현실적인 문제는 애당초 우리가 함수 안에 있는 코드를 수정할 수 없는 경우가 있다. 예를 들어서 Console.WriteLine() 같은 함수를 잘 활용했으나, 이 함수를 수정하는 일은 없었다. 수정할 수 있는 코드도 아니였고, Console 라이브러리는 마소에서 만든 코드였다. 마찬가지로 ButtonPressed() 가 수정할 수 없는 형태로 배포될 수 있을텐데 유니티 엔진을 고려해보면 유니티 엔진의 엔진까지 수정할 수 있는게 아니기때문에 버튼이 눌렸을 때, 우리가 원하는 함수를 실행하도록 ButtonPressed()를 고칠 수 없는 문제가 발생을 한다. 그렇다면 어떻게 구현할지가 혼란스러운데, 버튼을 눌렸을 때 할 행위를 인자로 넘겨주고싶은 상황이 생기게 되는 것이다.

함수 자체를 인자로 넘겨주고 어떤 조건이 만족하면 해당 함수를 호출하도록하는 함수를 선언하면, 유니티에서도 우리가 넘겨준 코드가 무엇인지 모른다고하더라도 우리가 필요로하는 함수를 잘 호출하여주면 됨. 
함수 자체를 인자로 넘겨주고 나중에 우리가 인자로 넘겨준 함수를 필요로할 때 함수 안쪽에서 역으로 호출하는 것을 콜백 방식이라고한다.
업체 사장님에게 연락을 할 때 사장님의 비서에게 미리 우리의 연락처와 용건을 준 다음에 나중에 거꾸로 연락을 주는 형태.
왜 필요한지 확실하게 와닿을 필요가 있다. 
직관적으로 생각했을 때 함수 타입과 깊은 연관성이 있다.

우리가 고칠 수 없는 함수에서 delegate의 성능이 상당히 발휘되는 것은 맞지만, 접근할 수 있더라도 delegate를 사용함으로써 얻을 수 있는 효과는 존재한다.

예를 들어, sorting 문제를 살펴보자.
[10, 20, 40, 30, 50]
우리가 어떤 함수를 인자로 넣어주느냐에 따라 작은 순서대로 나열될 수도 있고, 큰 순서대로 나열이 되는 다양한 방식으로 동작할 수 있는 함수를 만든다고 가정했을때, 두 숫자의 크기를 비교하는 부분만 공통적으로 묶어내는 등으로 다양하게 응용할 수 있다. 

OnClicked clicked = new OnClicked(TestDelegate);
            clicked += TestDelegate2;
            // 객체를 만들어서 사용하면 할 수 있는 기능 : delegate를 체이닝할 수 있다.
            // 하나의 함수만 넘겨주는게 아니라, 여러 함수를 동시에 넘겨줄 수 있다.